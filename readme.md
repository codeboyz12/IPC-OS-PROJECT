# üöÄ Advanced IPC Chat Server in C

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤ Operating Systems (ACS, KMUTT) ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏ò‡∏¥‡∏ï‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á Inter-Process Communication (IPC) ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Concurrency ‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤ C

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Server Loop ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ ‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô **Server ‡πÅ‡∏ö‡∏ö Multi-Thread ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á** ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏ö‡∏ö **Router-Worker (Producer-Consumer)** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å

‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:
* **System V Message Queues:** (`msgget`, `msgsnd`, `msgrcv`)
* **Pthreads:** (POSIX Threads)
* **Reader-Writer Locks:** (`pthread_rwlock_t`) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á State ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
* **Mutexes & Condition Variables:** (`pthread_mutex_t`, `pthread_cond_t`) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Job Queue

---

## üèõÔ∏è ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏° (Architecture)

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà ‡∏ã‡∏∂‡πà‡∏á‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏≠‡∏Ç‡∏ß‡∏î (Bottleneck) ‡πÅ‡∏•‡∏∞ Race Condition ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

### 1. Client IPC: `IPC_PRIVATE` (‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ PID)

‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ Client **‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ `getpid()` ‡πÄ‡∏õ‡πá‡∏ô Key ‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ**
1.  **`client.c`** ‡∏™‡∏£‡πâ‡∏≤‡∏á Reply Queue (‡∏Ñ‡∏¥‡∏ß‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß) ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `msgget(IPC_PRIVATE, ...)` ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏Å‡∏≤‡∏£‡∏±‡∏ô‡∏ï‡∏µ‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ ID ‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
2.  Client ‡∏à‡∏∞‡∏™‡πà‡∏á `reply_qid` (ID ‡∏Ñ‡∏¥‡∏ß‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß) ‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÉ‡∏´‡πâ Server ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `CMD_REGISTER`
3.  Server ‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö `reply_qid` ‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `GlobalRegistry` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏≤ Client ‡∏Ñ‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞

### 2. Server Architecture: Router-Worker Pattern

Server ‡∏ñ‡∏π‡∏Å‡πÅ‡∏ö‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 3 ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏Å (‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏ò‡∏£‡∏î) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏ô‡∏≤‡∏ô‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ:

* **1. Router Thread (‡πÄ‡∏ò‡∏£‡∏î‡∏à‡∏±‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á)**
    * ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ò‡∏£‡∏î *‡πÄ‡∏î‡∏µ‡∏¢‡∏ß* ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≠‡∏¢ `msgrcv` (‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á) ‡∏à‡∏≤‡∏Å `CONTROL_QUEUE_KEY` (‡∏Ñ‡∏¥‡∏ß‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏´‡∏•‡∏±‡∏Å)
    * **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏£‡∏±‡∏ö `CommandMessage` -> ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï `last_active` ‡∏Ç‡∏≠‡∏á Client -> ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Handler ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô `handle_join`, `handle_msg`)
    * **‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß:** ‡πÄ‡∏ò‡∏£‡∏î‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ "‡πÑ‡∏°‡πà" ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡πâ‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô `msgsnd`) ‡πÅ‡∏Ñ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á "‡∏á‡∏≤‡∏ô" (Job) ‡πÅ‡∏•‡πâ‡∏ß‡πÇ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ Job Queue

* **2. Broadcaster Pool (‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏ò‡∏£‡∏î‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏á‡∏≤‡∏ô)**
    * ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° Worker Threads (‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô `BROADCASTER_COUNT`) ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å Job Queue
    * **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** `get_job()` (‡∏£‡∏≠‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏°‡∏µ‡∏á‡∏≤‡∏ô) -> ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏á‡∏≤‡∏ô (‡πÄ‡∏ä‡πà‡∏ô "‡∏™‡πà‡∏á DM" ‡∏´‡∏£‡∏∑‡∏≠ "Broadcast ‡πÑ‡∏õ‡∏´‡πâ‡∏≠‡∏á #general") ‡πÄ‡∏ò‡∏£‡∏î‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà `msgsnd` ‡∏ó‡∏µ‡πà‡∏ä‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ô‡πà‡∏≤‡πÄ‡∏ö‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á Client ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
    * **‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û:** ‡πÉ‡∏ä‡πâ `IPC_NOWAIT` ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ `send_reply` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ Client ‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏°‡∏≤‡∏ö‡∏•‡πá‡∏≠‡∏Å Server ‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö

* **3. Monitor Thread (‡πÄ‡∏ò‡∏£‡∏î‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á)**
    * ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏° ‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏∑‡πà‡∏ô‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ `last_active` ‡πÅ‡∏•‡∏∞‡∏•‡∏ö Client ‡∏ó‡∏µ‡πà `INACTIVITY_TIMEOUT`

### 3. Data Flow (‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)

‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á "‡∏™‡∏≤‡∏¢‡∏û‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï" ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô:

`Client` -> `[Control Queue]` -> **(Router)** -> `[Job Queue]` -> **(Broadcaster)** -> `[Reply Queues]` -> `Clients`

---

## üîí ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Concurrency (Concurrency Model)

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£:

* **`GlobalRegistry` (‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á Server):**
    * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• `clients` ‡πÅ‡∏•‡∏∞ `rooms` ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
    * ‡∏ñ‡∏π‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÇ‡∏î‡∏¢ **`pthread_rwlock_t` (Reader-Writer Lock)**
    * **‡∏ó‡∏≥‡πÑ‡∏°?** ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Å‡∏≤‡∏£ "‡∏≠‡πà‡∏≤‡∏ô" ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏ä‡πà‡∏ô `handle_msg`, `handle_dm`) ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡πà‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£ "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô" (‡πÄ‡∏ä‡πà‡∏ô `handle_join`, `handle_quit`) RW-Lock ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏ò‡∏£‡∏î *‡∏≠‡πà‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ* ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£ *‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô* -> ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ Mutex ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤‡∏°‡∏≤‡∏Å

* **`Job Queue` (‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏ó‡∏≥):**
    * ‡πÄ‡∏õ‡πá‡∏ô Linked List ‡∏ó‡∏µ‡πà Router (‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï) ‡∏™‡∏£‡πâ‡∏≤‡∏á ‡πÅ‡∏•‡∏∞ Broadcaster (‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ) ‡∏´‡∏¢‡∏¥‡∏ö‡πÑ‡∏õ‡∏ó‡∏≥
    * ‡∏ñ‡∏π‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÇ‡∏î‡∏¢ **`pthread_mutex_t`** (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏¥‡∏ß) ‡πÅ‡∏•‡∏∞ **`pthread_cond_t`** (‡πÉ‡∏ä‡πâ‡∏õ‡∏•‡∏∏‡∏Å‡πÄ‡∏ò‡∏£‡∏î Broadcaster ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á "‡∏´‡∏•‡∏±‡∏ö" ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤)

---

## üìÅ ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå (File Breakdown)

* **`project_defs.h` (The Contract)**
    * ‡πÑ‡∏ü‡∏•‡πå "‡∏™‡∏±‡∏ç‡∏ç‡∏≤" ‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á Server ‡πÅ‡∏•‡∏∞ Client ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô
    * ‡∏Å‡∏≥‡∏´‡∏ô‡∏î `CommandCode` (Enum) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
    * ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á `CommandMessage` (Client -> Server)
    * ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á `ReplyMessage` (Server -> Client)
    * ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á `Job` (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Job Queue ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Server)
    * ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á `GlobalRegistry` (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Server)

* **`main.c` (The Server)**
    * **`main()`:** ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏¥‡∏ß‡∏´‡∏•‡∏±‡∏Å, ‡∏™‡∏£‡πâ‡∏≤‡∏á `pthread_rwlock_t`, ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ò‡∏£‡∏î‡∏ó‡∏±‡πâ‡∏á 3 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (Router, Broadcaster Pool, Monitor)
    * **`router_thread()`:** ‡∏•‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö `CommandMessage` ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `handle_...`
    * **`handle_...()`:** ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà "‡∏™‡∏£‡πâ‡∏≤‡∏á" `Job` (‡πÄ‡∏ä‡πà‡∏ô `handle_msg` ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á `Job` ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó `CMD_MSG`) ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `add_job()`
    * **`add_job()` / `get_job()`:** ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Job Queue (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Mutex/Cond)
    * **`broadcaster_thread()`:** ‡∏•‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á Worker ‡∏ó‡∏µ‡πà‡∏£‡∏≠ `get_job()` ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `send_reply()`
    * **`send_reply()`:** ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `msgsnd` ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `IPC_NOWAIT`
    * **`monitor_clients()`:** ‡∏•‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≠‡∏¢‡πÄ‡∏ä‡πá‡∏Ñ Timeout (‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ `wrlock` ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏≠‡∏≤‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `remove_client`)

* **`client.c` (The Client)**
    * **`main()`:** ‡∏™‡∏£‡πâ‡∏≤‡∏á `reply_qid` ‡∏î‡πâ‡∏ß‡∏¢ `IPC_PRIVATE`, ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ñ‡∏¥‡∏ß Server, ‡∏™‡πà‡∏á `CMD_REGISTER` ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á 2 ‡πÄ‡∏ò‡∏£‡∏î
    * **`sender_thread()`:** ‡∏£‡∏≠ `fgets` ‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ, ‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (‡πÄ‡∏ä‡πà‡∏ô "JOIN #room", "MSG ..."), ‡∏™‡∏£‡πâ‡∏≤‡∏á `CommandMessage` struct ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `send_command()`
    * **`receiver_thread()`:** ‡∏£‡∏≠ `msgrcv` ‡∏ö‡∏ô `reply_qid` ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß ‡πÄ‡∏°‡∏∑‡πà‡∏≠ `ReplyMessage` ‡∏°‡∏≤‡∏ñ‡∏∂‡∏á ‡∏Å‡πá‡∏à‡∏∞‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
    * **`cleanup()`:** `msgctl(reply_qid, IPC_RMID, NULL)` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏¥‡∏î

---

## üõ†Ô∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Installation & Usage)

(‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô Container ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö IPC ‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)

### 1. Build Docker Image
(‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ `Dockerfile`, `main.c`, `client.c`, `project_defs.h` ‡πÉ‡∏ô directory ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
```bash
# (Dockerfile ‡∏Ñ‡∏ß‡∏£ COPY . . ‡πÅ‡∏•‡∏∞ CMD ["sleep", "infinity"])
docker build -t my-chat-app .

### 2. ‡∏£‡∏±‡∏ô Container ‡∏´‡∏•‡∏±‡∏Å (‡πÅ‡∏ö‡∏ö Detached)
‡πÄ‡∏õ‡∏¥‡∏î Terminal ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á "‡∏Å‡∏•‡πà‡∏≠‡∏á" ‡∏ó‡∏î‡∏™‡∏≠‡∏ö
```bash
docker run -d --name chat_container my-chat-app

### 3. ‡∏Ñ‡∏≠‡∏°‡πÑ‡∏û‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô Server
‡πÉ‡∏ä‡πâ `docker exec` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏£‡∏±‡∏ô Server *‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô* Container
```bash
# ‡∏Ñ‡∏≠‡∏°‡πÑ‡∏û‡∏•‡πå (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡πÉ‡∏ô Dockerfile)
docker exec chat_container gcc main.c -o server -lpthread
# ‡∏£‡∏±‡∏ô Server ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á
docker exec -d chat_container /app/server

### 4. ‡∏£‡∏±‡∏ô Client (‡πÉ‡∏ô Terminal ‡πÉ‡∏´‡∏°‡πà)
‡πÄ‡∏õ‡∏¥‡∏î Terminal ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Client ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô
```bash
# ‡∏Ñ‡∏≠‡∏°‡πÑ‡∏û‡∏•‡πå (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥)
docker exec chat_container gcc client.c -o client -lpthread
# ‡∏£‡∏±‡∏ô Client (‡πÅ‡∏ö‡∏ö‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö)
docker exec -it chat_container /app/client

### 5. Cleanup
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏•‡∏ö Container ‡∏ó‡∏¥‡πâ‡∏á
```bash
docker stop chat_container && docker rm chat_container